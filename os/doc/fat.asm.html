<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>fat.asm | ZI-28 Documentation</title>
	<link rel="stylesheet" href="styles.css" />
</head>

<body>
	<h1>ZI-28 Documentation</h1>
	<a href="index.html">&lt Back to index</a>

	<h2>File: fat.asm</h2>

	<div>
		<p>FAT-16 file system</p>
	</div>

		<div class="routines">
		<h3>Routines</h3>
					<div class="menuentry">
			<div class="menutitle">
				<a href=#fat_init>fat_init</a>
			</div>
			<div class="menudesc">
				<p>Calculate and store filesystem offsets</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#fat_open>fat_open</a>
			</div>
			<div class="menudesc">
				<p>Creates a new file table entry</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#fat_readdir>fat_readdir</a>
			</div>
			<div class="menudesc">
				<p>Get information about the next file in a directory.</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#fat_fstat>fat_fstat</a>
			</div>
			<div class="menudesc">
				<p>Get information about a file.</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#fat_statFromEntry>fat_statFromEntry</a>
			</div>
			<div class="menudesc">
				<p>Creates a stat from a directory entry.</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#fat_read>fat_read</a>
			</div>
			<div class="menudesc">
				<p>Copy data from a file to memory</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#fat_nextCluster>fat_nextCluster</a>
			</div>
			<div class="menudesc">
				<p>Find the next cluster of a chain from the first FAT</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#fat_clusterToAddr>fat_clusterToAddr</a>
			</div>
			<div class="menudesc">
				<p>Calculate the starting address of a cluster</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#fat_buildFilename>fat_buildFilename</a>
			</div>
			<div class="menudesc">
				<p>Creates a 8.3 string from a directory entry</p>
			</div>
		</div>
			
					<div id="fat_init" class="box">
			<div class="boxheader">
				<p>fat_init</p>
			</div>
			<div class="boxcontent">
				<p>Calculate and store filesystem offsets</p>
<dl>
<dt>Input:</dt>
<dd>a - fd of device containing the fs
</dd>
<dd>ix - drive table entry address
</dd>
</dl>
			</div>
		</div>
							<div id="fat_open" class="box">
			<div class="boxheader">
				<p>fat_open</p>
			</div>
			<div class="boxcontent">
				<p>Creates a new file table entry</p>
<dl>
<dt>Input:</dt>
<dd>ix - table entry
</dd>
<dd>(de) - absolute path
</dd>
<dt>Output:</dt>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="fat_readdir" class="box">
			<div class="boxheader">
				<p>fat_readdir</p>
			</div>
			<div class="boxcontent">
				<p>Get information about the next file in a directory.</p>
<dl>
<dt>Input:</dt>
<dd>a - dirfd
</dd>
<dd>(de) - stat
</dd>
<dt>Output:</dt>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="fat_fstat" class="box">
			<div class="boxheader">
				<p>fat_fstat</p>
			</div>
			<div class="boxcontent">
				<p>Get information about a file.</p>
<dl>
<dt>Input:</dt>
<dd>ix - file entry addr
</dd>
<dd>(de) - stat
</dd>
<dt>Output:</dt>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="fat_statFromEntry" class="box">
			<div class="boxheader">
				<p>fat_statFromEntry</p>
			</div>
			<div class="boxcontent">
				<p>Creates a stat from a directory entry.</p>
<dl>
<dt>Input:</dt>
<dd>(de) - stat
</dd>
</dl>
			</div>
		</div>
							<div id="fat_read" class="box">
			<div class="boxheader">
				<p>fat_read</p>
			</div>
			<div class="boxcontent">
				<p>Copy data from a file to memory</p>
<dl>
<dt>Input:</dt>
<dd>ix - file entry addr
</dd>
<dd>(de) - buffer
</dd>
<dd>bc - count
</dd>
<dt>Output:</dt>
<dd>a - errno
</dd>
<dd>de - count
</dd>
</dl>
			</div>
		</div>
							<div id="fat_nextCluster" class="box">
			<div class="boxheader">
				<p>fat_nextCluster</p>
			</div>
			<div class="boxcontent">
				<p>Find the next cluster of a chain from the first FAT</p>
<dl>
<dt>Input:</dt>
<dd>a - device fd
</dd>
<dd>hl - current cluster
</dd>
<dt>Output:</dt>
<dd>hl - next cluster
</dd>
<dd>carry - the current cluster is the last of the chain
</dd>
<dt>Preserved:</dt>
<dd>a
</dd>
</dl>
			</div>
		</div>
							<div id="fat_clusterToAddr" class="box">
			<div class="boxheader">
				<p>fat_clusterToAddr</p>
			</div>
			<div class="boxcontent">
				<p>Calculate the starting address of a cluster</p>
<dl>
<dt>Input:</dt>
<dd>(hl) - 32-bit cluster number
</dd>
<dd>iy - drive table entry
</dd>
<dt>Output:</dt>
<dd>(hl) - address
</dd>
</dl>
			</div>
		</div>
							<div id="fat_buildFilename" class="box">
			<div class="boxheader">
				<p>fat_buildFilename</p>
			</div>
			<div class="boxcontent">
				<p>Creates a 8.3 string from a directory entry</p>
<dl>
<dt>Input:</dt>
<dd>(hl) - dir entry
</dd>
<dd>(de) - filename buffer (max. length: 13 bytes)
</dd>
<dt>Destroyed:</dt>
<dd>a, bc, de, hl
</dd>
</dl>
			</div>
		</div>
				</div>
	


<footer>
</footer>


</body>
</html>
