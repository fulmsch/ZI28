<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>file.asm | ZI-28 Documentation</title>
	<link rel="stylesheet" href="styles.css" />
</head>

<body>
	<h1>ZI-28 Documentation</h1>
	<a href="index.html">&lt Back to index</a>

	<h2>File: file.asm</h2>

	<div>
		
	</div>

		<div class="routines">
		<h3>Routines</h3>
					<div class="menuentry">
			<div class="menutitle">
				<a href=#getFileAddr>getFileAddr</a>
			</div>
			<div class="menudesc">
				<p>Finds the file entry of a given fd</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#k_open>k_open</a>
			</div>
			<div class="menudesc">
				<p>Open a file / device file</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#k_close>k_close</a>
			</div>
			<div class="menudesc">
				<p>Close a file</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#k_readdir>k_readdir</a>
			</div>
			<div class="menudesc">
				<p>Get information about the next file in a directory.</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#k_stat>k_stat</a>
			</div>
			<div class="menudesc">
				<p>Get information about a file.</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#k_fstat>k_fstat</a>
			</div>
			<div class="menudesc">
				<p>Get information about an open file.</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#k_read>k_read</a>
			</div>
			<div class="menudesc">
				<p>Read from an open file</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#k_write>k_write</a>
			</div>
			<div class="menudesc">
				<p>Write to an open file</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#k_seek>k_seek</a>
			</div>
			<div class="menudesc">
				<p>Change the file offset of an open file using a 16-bit offset.</p>
			</div>
		</div>
							<div class="menuentry">
			<div class="menutitle">
				<a href=#k_lseek>k_lseek</a>
			</div>
			<div class="menudesc">
				<p>Change the file offset of an open file using a 32-bit offset.</p>
			</div>
		</div>
			
					<div id="getFileAddr" class="box">
			<div class="boxheader">
				<p>getFileAddr</p>
			</div>
			<div class="boxcontent">
				<p>Finds the file entry of a given fd</p>
<dl>
<dt>Input:</dt>
<dd>a - file descriptor
</dd>
<dt>Output:</dt>
<dd>hl - table entry address
</dd>
<dd>carry - out of bounds
</dd>
<dd>nc - no error
</dd>
<dt>See also:</dt>
<dd><a href="drive.asm.html#getTableAddr">getTableAddr</a>
</dd>
</dl>
			</div>
		</div>
							<div id="k_open" class="box">
			<div class="boxheader">
				<p>k_open</p>
			</div>
			<div class="boxcontent">
				<p>Open a file / device file</p>
<p>Creates a new file table entry and returns the corresponding fd</p>
<p>Exactly one of the following flags must be set:</p>
<ul>
<li><code>O_RDONLY</code> : Open for reading only.</li>
<li><code>O_WRONLY</code> : Open for writing only.</li>
<li><code>O_RDWR</code> : Open for reading and writing.</li>
</ul>
<p>Additionally, zero or more of the following flags may be specified: (PLANNED)</p>
<ul>
<li><code>O_APPEND</code> : Before each write, the file offset is positioned at the end of the file.</li>
<li><code>O_DIRECTORY</code> : Causes open to fail if the specified file is not a directory.</li>
<li><code>O_TRUNC</code> : If the file exists and opened for writing, its size gets truncated to 0.</li>
</ul>
<p>Before calling the filesystem routine, the mode field gets populated with the requested access mode. The filesystem routine should return with an error if the required permissions are missing. On success it should bitwise OR the filetype with the mode.</p>
<dl>
<dt>Input:</dt>
<dd>(de) - pathname
</dd>
<dd>a - mode
</dd>
<dt>Output:</dt>
<dd>e - file descriptor
</dd>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="k_close" class="box">
			<div class="boxheader">
				<p>k_close</p>
			</div>
			<div class="boxcontent">
				<p>Close a file</p>
<p>Closes a file and makes its fd available again</p>
<dl>
<dt>Input:</dt>
<dd>a - file descriptor
</dd>
<dt>Output:</dt>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="k_readdir" class="box">
			<div class="boxheader">
				<p>k_readdir</p>
			</div>
			<div class="boxcontent">
				<p>Get information about the next file in a directory.</p>
<dl>
<dt>Input:</dt>
<dd>a - dirfd
</dd>
<dd>(de) - stat
</dd>
<dt>Output:</dt>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="k_stat" class="box">
			<div class="boxheader">
				<p>k_stat</p>
			</div>
			<div class="boxcontent">
				<p>Get information about a file.</p>
<dl>
<dt>Input:</dt>
<dd>(de) - filename
</dd>
<dd>(hl) - stat
</dd>
<dt>Output:</dt>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="k_fstat" class="box">
			<div class="boxheader">
				<p>k_fstat</p>
			</div>
			<div class="boxcontent">
				<p>Get information about an open file.</p>
<dl>
<dt>Input:</dt>
<dd>a - fd
</dd>
<dd>(de) - stat
</dd>
<dt>Output:</dt>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="k_read" class="box">
			<div class="boxheader">
				<p>k_read</p>
			</div>
			<div class="boxcontent">
				<p>Read from an open file</p>
<p>Finds and calls the read routine of the corresponding file driver.</p>
<dl>
<dt>Input:</dt>
<dd>a - file descriptor
</dd>
<dd>(de) - buffer
</dd>
<dd>hl - count
</dd>
<dt>Output:</dt>
<dd>de - count
</dd>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="k_write" class="box">
			<div class="boxheader">
				<p>k_write</p>
			</div>
			<div class="boxcontent">
				<p>Write to an open file</p>
<p>Finds and calls the write routine of the corresponding file driver.</p>
<dl>
<dt>Input:</dt>
<dd>a - file descriptor
</dd>
<dd>(de) - buffer
</dd>
<dd>hl - count
</dd>
<dt>Output:</dt>
<dd>de - count
</dd>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="k_seek" class="box">
			<div class="boxheader">
				<p>k_seek</p>
			</div>
			<div class="boxcontent">
				<p>Change the file offset of an open file using a 16-bit offset.</p>
<p>The new offset is calculated according to whence as follows:</p>
<ul>
<li><code>SEEK_SET</code> : from start of file</li>
<li><code>SEEK_PCUR</code> : from current location in positive direction</li>
<li><code>SEEK_NCUR</code> : from current location in negative direction</li>
<li><code>SEEK_END</code> : from end of file in negative direction</li>
</ul>
<dl>
<dt>Input:</dt>
<dd>a - file descriptor
</dd>
<dd>de - offset
</dd>
<dd>h - whence
</dd>
<dt>Output:</dt>
<dd>(de) - new offset from start of file
</dd>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
							<div id="k_lseek" class="box">
			<div class="boxheader">
				<p>k_lseek</p>
			</div>
			<div class="boxcontent">
				<p>Change the file offset of an open file using a 32-bit offset.</p>
<p>The new offset is calculated according to whence as follows:</p>
<ul>
<li><code>SEEK_SET</code> : from start of file</li>
<li><code>SEEK_PCUR</code> : from current location in positive direction</li>
<li><code>SEEK_NCUR</code> : from current location in negative direction</li>
<li><code>SEEK_END</code> : from end of file in negative direction</li>
</ul>
<dl>
<dt>Input:</dt>
<dd>a - file descriptor
</dd>
<dd>(de) - offset
</dd>
<dd>h - whence
</dd>
<dt>Output:</dt>
<dd>(de) - new offset from start of file
</dd>
<dd>a - errno
</dd>
</dl>
			</div>
		</div>
				</div>
	


<footer>
</footer>


</body>
</html>
